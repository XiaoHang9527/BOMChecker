# BOM检查工具 V1.8

## 简介
BOM检查工具是一款专为电子工程师设计的应用程序，能够自动对比BOM表与原理图中的位号一致性，支持替代料识别、重复位号检测及物料信息注解，大幅提升元器件核对效率。

## 安装说明

### 1. 必要依赖
使用本程序需要安装以下Python依赖：
- pandas：数据处理
- pymupdf：PDF处理
- openpyxl：Excel文件处理
- pillow：图像处理
- psutil：系统资源监控（可选）

### 2. 安装方法

#### 方法一：使用requirements.txt安装所有依赖
```bash
# 推荐使用管理员权限运行，确保所有依赖能正确安装
pip install -r requirements.txt
```

#### 方法二：单独安装各个依赖
```bash
pip install pandas
pip install pymupdf
pip install openpyxl
pip install pillow
pip install psutil
```

### 3. 打包为exe
如果需要将程序打包为可执行文件，推荐使用PyInstaller：

```bash
# 安装PyInstaller
pip install pyinstaller

# 打包程序
pyinstaller --add-data "icon.ico;." --noconsole --icon=icon.ico BOM_Checker.py
```

## 使用说明
1. 选择BOM文件（Excel格式）
2. 选择PDF原理图文件（可选，如不选择则进入仅BOM检查模式）
3. 点击"开始检查"按钮
4. 查看处理结果，对于PDF处理结果可以选择打开或保存

## 功能特点
- 多进程处理，高效处理大型PDF文件
- 智能识别BOM表头，支持自定义表头映射
- 自动匹配位号，支持多种格式
- 高亮标注PDF位号，支持定制颜色
- 可选添加物料信息注解

## 更新日志
- V1.8：优化当位号间隔用中文逗号时，无法正确计算位号数量的问题。
- V1.7：优化厂商物料重复检测失效的问题,优化检查位号数量失效的问题
- V1.6：所有错误信息中文化显示，修复BOM表头映射保存问题
- V1.5：增强表头识别功能，优化用户界面交互
- V1.4：修复纯数字料号处理问题，增强空值处理
- V1.3：修复Windows下打包为exe后的多进程问题，增强依赖检查
- V1.2：增加多进程PDF处理，提高大文件处理性能
- V1.1：添加物料注解功能，支持自定义BOM表头
- V1.0：基础版本，支持BOM与PDF对比

## 已知问题与解决方案
如果您遇到"No module named 'fitz'"错误，请确保已安装PyMuPDF库：
```bash
pip install pymupdf
```

## 技术支持
如需技术支持或报告问题，请提供以下信息：
- 程序版本
- 操作系统版本
- Python版本
- 完整的错误信息

## 主要功能
- 自动从BOM文件中提取位号信息
- 智能识别和跳过项目信息行，自动检测表头位置
- **增强的BOM数据验证功能**：
  - 检查重复料号和厂商料号，识别相同料号在不同行中的使用情况
  - 检查重复位号，考虑替代料关系
  - 先进的替代料关系识别算法，支持多种识别策略
  - 核对位号数量与BOM中数量列值是否匹配
- 在PDF原理图上高亮标记BOM中列出的元器件位号
- **物料信息注解功能**：
  - 可选择在高亮位号的同时添加包含该位号对应物料信息的注解
  - 注解默认隐藏，点击后显示完整的物料信息
  - 包含料号、物料描述、厂商料号和制造商等详细信息
- 自动检测位号的匹配情况，并展示匹配与缺失的统计结果
- 多线程处理，高效处理大型原理图
- 多进程架构，保持界面响应流畅
- 内存管理优化，支持处理大型BOM和PDF文件

## 增强的BOM文件支持
- **自动识别BOM表头**：无需手动预处理BOM文件，工具会智能识别和跳过项目信息行
- **高级替代料关系处理**：
  - 基于Item编号格式（如xx.1、xx.2）的标准替代料识别
  - 基于替代料组字典的关联识别
  - 基于料号相似度的启发式识别（支持对多个物料进行分析）
  - 相同位号在替代料之间不视为冲突
  - 替代料的位号在PDF中只标注一次
  - 统计位号数量时，替代料关系中的位号只计算一次
- **位号数量核对**：自动检查BOM中的位号实际数量与quantity列的值是否匹配
- **物料信息集成**：支持提取BOM中完整的物料信息并与PDF原理图中的位号关联
- **支持多种BOM格式**：通过自定义表头映射支持不同格式的BOM文件

## 性能优化
- **多进程架构**：PDF处理在单独进程中运行，避免UI卡顿
- **智能线程管理**：自动根据CPU核心数计算最佳线程数(核心数×1.5)
- **内存优化**：使用页面处理器分批处理PDF页面，减少内存占用
- **进度实时更新**：通过队列通信实现处理进度的实时显示
- **自动内存优先级调整**：Windows系统下自动调整处理优先级

## 开发信息
- 版本：V1.8
- 开发语言：Python 3
- 开发者：小航
- 更新日期：2025年5月27日

## 使用方法
1. 运行程序，启动现代化界面
2. 点击"选择BOM文件"，导入Excel格式的BOM表格
3. 点击"选择原理图"，导入需要检查的PDF原理图（可选，不选择则进入仅BOM检查模式）
4. 点击"设置"，根据需要配置高亮颜色和是否添加物料信息注解
5. 点击"开始检查"，程序将自动提取位号并在PDF上标记
6. 检查完成后，查看结果统计和未找到的位号列表
7. 点击界面上的"打开"按钮查看生成的标记版PDF
8. 若启用了物料信息注解，可以在PDF阅读器中点击位号附近的注解图标查看详细信息

## BOM表头映射设置
- 程序支持自定义BOM表头映射，适应不同格式的BOM文件
- 点击"设置"→"编辑BOM表头映射"，可以为每种数据类型添加可能的表头名称
- 支持搜索、添加、编辑和删除表头映射项
- 系统会优先使用用户定义的映射，大大提高BOM识别的准确性

## 常见问题
- **问题**：程序无法识别位号列
  **解决方案**：程序会尝试自动识别位号列，如果无法识别，会弹出对话框让用户手动选择；用户可以在BOM表头映射设置中添加常用的位号列名称

- **问题**：PDF中部分位号没有被标记
  **解决方案**：确保PDF是文本版本，而非扫描版；有些特殊符号可能会影响匹配，请检查BOM中位号格式

- **问题**：物料信息注解不显示完整信息
  **解决方案**：确保BOM文件中相关列（如料号、描述、厂商等）能被正确识别；您可以在BOM表头映射设置中添加相应的列名

- **问题**：处理大型PDF时系统响应缓慢
  **解决方案**：程序已进行多进程优化，但对于特别大的PDF文件，可能仍需较长处理时间；请耐心等待或考虑将原理图拆分为多个文件处理

- **问题**：替代料无法正确识别
  **解决方案**：程序支持多种替代料识别策略，包括基于Item格式、基于物料编号相似度的识别；您可以在BOM中使用标准的替代料格式（如xx.1、xx.2）或确保替代料的物料编号相似

## 系统需求
- 操作系统：Windows 7/10/11
- Python 3.6+
- 必要的Python库：tkinter, pandas, PyMuPDF (fitz), openpyxl, psutil
